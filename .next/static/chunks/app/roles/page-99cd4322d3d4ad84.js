(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1550],{6940:function(e,s,t){Promise.resolve().then(t.bind(t,3690))},3690:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return Z}});var a=t(7437),n=t(3107),c=t(146),i=t(7907),l=t(2265),r=t(8009),o=t(7948),d=t(4590),h=t(2498),u=t(8489),m=t(1352),x=t(6795),p=t(8033),j=t(4845),f=t(7742),g=t(4353);let v=(0,f.j)("peer relative  inline-flex items-center  [&_.content-box>svg]:h-4  [&_.content-box>svg]:w-4  [&_.content-box]:text-primary-foreground [&_.content-box]:text-[10px] justify-start group  flex-shrink-0  cursor-pointer rounded-full  transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=unchecked]:bg-default-300",{variants:{color:{primary:"data-[state=checked]:bg-primary ",secondary:"data-[state=checked]:bg-secondary ",info:"data-[state=checked]:bg-info ",warning:"data-[state=checked]:bg-warning ",success:"data-[state=checked]:bg-success ",destructive:"data-[state=checked]:bg-destructive ",dark:"data-[state=checked]:bg-foreground "},size:{sm:"h-4 w-[30px]  [&_.content-box]:text-[7px] [&_.content-box>svg]:h-2.5  [&_.content-box>svg]:w-2.5 ",md:"h-5 w-[38px] ",lg:"h-6 w-[42px]"}},defaultVariants:{color:"primary",size:"md"}}),y=l.forwardRef((e,s)=>{let{className:t,size:n,color:c,startContent:i,endContent:l,thumbClass:r,thumbIcon:o,...d}=e;return(0,a.jsxs)(j.fC,{className:(0,g.cn)(v({size:n,color:c}),t),...d,ref:s,children:[i&&(0,a.jsx)("span",{className:"absolute left-1  content-box   text-medium opacity-0 scale-50 transition-transform-opacity group-data-[state=checked]:scale-100 group-data-[state=checked]:opacity-100 ",children:i}),(0,a.jsx)(j.bU,{className:(0,g.cn)("pointer-events-none z-10 origin-right  h-4 w-4 rounded-full bg-background  shadow-lg ring-0 transition-all  flex items-center justify-center   ltr:data-[state=checked]:ml-5 rtl:data-[state=checked]:mr-5 rtl:data-[state=unchecked]:mr-0.5 ",r,{"h-3 w-3 data-[state=checked]:ml-4 ":"sm"===n,"h-4 w-4 ":"md"===n,"h-5 w-5 ":"lg"===n}),children:o||null}),l&&(0,a.jsx)("span",{className:"z-0  content-box   absolute right-1  text-medium opacity-100 transition-transform-opacity group-data-[state=checked]:translate-x-3 group-data-[state=checked]:opacity-0  ",children:l})]})});y.displayName=j.fC.displayName;var b=t(4273),k=e=>{let{icon:s,fetchAllRoles:t,id:o}=e,[u,j]=(0,l.useState)({rolename:"",permissions:{}}),[f,g]=(0,l.useState)([]),[v,k]=(0,l.useState)([]),w=(0,i.useRouter)();(0,l.useEffect)(()=>{(async()=>{await N(o),await C()})()},[o]);let N=async e=>{try{let s=await n.Z.get("".concat("https://192.168.1.12:5002","/api/roles/").concat(e),{headers:{"x-auth-token":c.Z.get("authToken")}});j(s.data)}catch(e){console.error("Error fetching role:",e)}},C=async()=>{try{let e=await n.Z.get("".concat("https://192.168.1.12:5002","/api/permissions"),{headers:{"x-auth-token":c.Z.get("authToken")}});if(200===e.status){let s=e.data.permissions;g(s),k([...new Set(Object.keys(s).map(e=>e.split(":")[0]))])}}catch(e){console.error("Error fetching permissions:",e)}},Z=(e,s)=>{j(t=>{let a;let n=t.permissions[e]||[];return a=n.some(e=>e.name.includes(s))?n.filter(e=>!e.name.includes(s)):[...n,{name:"".concat(e,":").concat(s)}],{...t,permissions:{...t.permissions,[e]:a}}})},R=async()=>{try{await n.Z.put("".concat("https://192.168.1.12:5002","/api/roles/").concat(o),u,{headers:{"x-auth-token":c.Z.get("authToken")}}),r.ZP.success("Role updated successfully"),t()}catch(e){(0,b.Z)(e,w)}};return(0,a.jsxs)(m.Vq,{children:[(0,a.jsx)(m.hg,{onClick:()=>{N(o),C()},asChild:!0,children:s}),(0,a.jsxs)(m.cZ,{size:"5xl",className:"p-0",children:[(0,a.jsx)(m.fK,{className:"p-6 pb-2",children:(0,a.jsx)(m.$N,{className:"text-base font-medium",children:"Update Roles"})}),(0,a.jsxs)("div",{className:"max-h-full px-6",children:[(0,a.jsx)("div",{className:"sm:grid sm:grid-cols-1 sm:gap-5 space-y-4 sm:space-y-0",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(p._,{children:"Role Name"}),(0,a.jsx)(x.I,{value:(null==u?void 0:u.rolename)||"",onChange:e=>j({...u,rolename:e.target.value}),type:"text",placeholder:"Enter role name"})]})}),(0,a.jsxs)(h.iA,{children:[(0,a.jsx)(h.xD,{children:(0,a.jsxs)(h.SC,{children:[(0,a.jsx)(h.ss,{children:"Permissions"}),(0,a.jsx)(h.ss,{children:"Read"}),(0,a.jsx)(h.ss,{children:"Write"}),(0,a.jsx)(h.ss,{children:"Update"}),(0,a.jsx)(h.ss,{children:"Delete"})]})}),(0,a.jsx)(h.RM,{children:v.map(e=>(0,a.jsxs)(h.SC,{children:[(0,a.jsx)(h.pj,{children:e}),["read","write","update","delete"].map(s=>{var t;let n=!f[e].some(t=>t.name.startsWith(e)&&t.name.endsWith(s)),c=null===(t=u.permissions[e])||void 0===t?void 0:t.some(t=>t.name==="".concat(e,":").concat(s));return(0,a.jsx)(h.pj,{children:(0,a.jsx)(y,{checked:c,onClick:()=>Z(e,s),disabled:n})},s)})]},e))})]})]}),(0,a.jsxs)("div",{className:"p-6 pt-4 flex justify-between",children:[(0,a.jsx)(m.GG,{asChild:!0,children:(0,a.jsx)(d.z,{type:"button",color:"warning",children:"Close"})}),(0,a.jsx)(d.z,{type:"submit",onClick:R,children:"Submit"})]})]})]})},w=e=>{let{fetchAllRoles:s,roles:t,fetchAllPermissions:m}=e,[x,p]=(0,l.useState)([]),j=(0,i.useRouter)(),f=e=>{let s=[...x];x.includes(e)?s.splice(x.indexOf(e),1):s.push(e),p(s)},g=async e=>{try{let t=await n.Z.delete("".concat("https://192.168.1.12:5002","/api/roles/").concat(e),{headers:{"x-auth-token":c.Z.get("authToken")}});200===t.status&&(r.ZP.success("Role deleted successfully"),s())}catch(e){409===e.response.status&&r.ZP.error("User exists in this role!"),(0,b.Z)(e,j)}};return(0,a.jsx)(a.Fragment,{children:t&&(0,a.jsxs)(h.iA,{children:[(0,a.jsx)(h.xD,{children:(0,a.jsxs)(h.SC,{children:[(0,a.jsx)(h.ss,{children:(0,a.jsx)(u.X,{checked:x.length===t.length||"indeterminate",onCheckedChange:()=>{(null==x?void 0:x.length)===(null==t?void 0:t.length)?p([]):p(t.map(e=>e.id))}})}),(0,a.jsx)(h.ss,{className:" font-semibold",children:"Role Name"}),(0,a.jsx)(h.ss,{children:"Permissions"}),(0,a.jsx)(h.ss,{children:"Action"})]})}),(0,a.jsx)(h.RM,{children:t.map(e=>{var t;return(0,a.jsx)(a.Fragment,{children:e.deleted_at?null:(0,a.jsxs)(h.SC,{className:"hover:bg-muted","data-state":x.includes(e._id)&&"selected",children:[(0,a.jsx)(h.pj,{children:(0,a.jsx)(u.X,{checked:x.includes(e._id),onCheckedChange:()=>f(e._id)})}),(0,a.jsx)(h.pj,{children:e.name.charAt(0).toUpperCase()+e.name.slice(1)}),(0,a.jsx)(h.pj,{children:e.permissions.map(e=>e.name).join(", ")}),(0,a.jsx)(h.pj,{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"flex gap-3",children:[(null===(t=localStorage.getItem("userPermissions"))||void 0===t?void 0:t.includes("roles:update"))&&(0,a.jsx)(k,{icon:(0,a.jsx)(d.z,{size:"icon",variant:"outline",className:"h-7 w-7",color:"secondary",children:(0,a.jsx)(o.JO,{icon:"heroicons:pencil",className:" h-4 w-4"})}),fetchAllRoles:s,id:e._id,fetchAllPermissions:m}),localStorage.getItem("userPermissions").includes("roles:delete")&&(0,a.jsx)(d.z,{onClick:()=>g(e._id),size:"icon",variant:"outline",className:" h-7 w-7",color:"secondary",children:(0,a.jsx)(o.JO,{icon:"heroicons:trash",className:" h-4 w-4"})})]})})]},e._id)})})})]})})},N=t(94),C=e=>{let{fetchAllRoles:s,fetchAllPermissions:t}=e,[o,u]=(0,l.useState)({name:"",permissions:{}}),[j,f]=(0,l.useState)([]),[g,v]=(0,l.useState)([]),k=(0,i.useRouter)();(0,l.useEffect)(()=>{(async()=>{let e=await t();f(e),v([...new Set(Object.keys(e).map(e=>e.split(":")[0]))])})()},[t]);let w=(e,s)=>j[e].some(t=>t.name==="".concat(e,":").concat(s)),C=(e,s)=>{var t;return(null===(t=o.permissions[e])||void 0===t?void 0:t.includes("".concat(e,":").concat(s)))||!1},Z=(e,s)=>{u(t=>{let a;let n=t.permissions[e]||[];return a=n.includes("".concat(e,":").concat(s))?n.filter(t=>t!=="".concat(e,":").concat(s)):[...n,"".concat(e,":").concat(s)],{...t,permissions:{...t.permissions,[e]:a}}})},R=async()=>{if(!o.name){r.ZP.error("Please enter a role name!");return}if(0===Object.keys(o.permissions).length){r.ZP.error("Please select at least one permission!");return}try{await n.Z.post("".concat("https://192.168.1.12:5002","/api/roles"),o,{headers:{"x-auth-token":c.Z.get("authToken")}}),r.ZP.success("Role added successfully!"),s(),u({name:"",permissions:{}})}catch(s){var e,t,a;if((null==s?void 0:null===(e=s.response)||void 0===e?void 0:e.status)===409){r.ZP.error(null==s?void 0:null===(a=s.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.msg);return}u({name:"",permissions:{}}),(0,b.Z)(s,k)}};return(0,a.jsxs)(m.Vq,{children:[(0,a.jsx)(m.hg,{asChild:!0,children:(0,a.jsxs)(d.z,{children:[(0,a.jsx)(N.Z,{}),"Add Role"]})}),(0,a.jsxs)(m.cZ,{size:"5xl",className:"p-0",children:[(0,a.jsx)(m.fK,{className:"p-6 pb-2",children:(0,a.jsx)(m.$N,{className:"text-base font-medium",children:"Add New Role"})}),(0,a.jsxs)("div",{className:"max-h-full px-6",children:[(0,a.jsx)("div",{className:"sm:grid sm:grid-cols-1 sm:gap-5 space-y-4 sm:space-y-0",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(p._,{children:"Role Name"}),(0,a.jsx)(x.I,{value:(null==o?void 0:o.name)||"",onChange:e=>u({...o,name:e.target.value}),type:"text",placeholder:"Enter role name"})]})}),(0,a.jsxs)(h.iA,{className:"text-left",children:[(0,a.jsx)(h.xD,{children:(0,a.jsxs)(h.SC,{children:[(0,a.jsx)(h.ss,{children:"Permissions"}),(0,a.jsx)(h.ss,{children:"Read"}),(0,a.jsx)(h.ss,{children:"Write"}),(0,a.jsx)(h.ss,{children:"Update"}),(0,a.jsx)(h.ss,{children:"Delete"})]})}),(0,a.jsx)(h.RM,{children:g.map(e=>(0,a.jsxs)(h.SC,{children:[(0,a.jsx)(h.pj,{children:e}),["read","write","update","delete"].map(s=>{let t=!w(e,s),n=C(e,s);return(0,a.jsx)(h.pj,{className:"last:text-left",children:(0,a.jsx)(y,{checked:n,onClick:()=>Z(e,s),disabled:t})},s)})]},e))})]})]}),(0,a.jsxs)("div",{className:"p-6 pt-4 flex justify-between",children:[(0,a.jsx)(m.GG,{asChild:!0,children:(0,a.jsx)(d.z,{type:"button",color:"warning",children:"Close"})}),(0,a.jsx)(d.z,{type:"submit",onClick:R,children:"Submit"})]})]})]})},Z=e=>{var s;let{trans:t}=e,[r,o]=(0,l.useState)([]),d=(0,i.useRouter)(),h=async()=>{try{let e=await n.Z.get("".concat("https://192.168.1.12:5002","/api/permissions"),{headers:{"x-auth-token":c.Z.get("authToken")}});if(200===e.status)return e.data.permissions}catch(e){console.error(e)}},u=async()=>{try{let e=await n.Z.get("".concat("https://192.168.1.12:5002","/api/roles"),{headers:{"x-auth-token":c.Z.get("authToken")}});200===e.status&&o(e.data)}catch(e){(0,b.Z)(e,d)}};return(0,l.useEffect)(()=>{u()},[]),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center flex-wrap justify-between mt-4 gap-4",children:[(0,a.jsx)("div",{className:"text-2xl font-medium text-default-800 ",children:"Roles"}),(null===(s=localStorage.getItem("userPermissions"))||void 0===s?void 0:s.includes("roles:write"))&&(0,a.jsx)(C,{fetchAllRoles:u,fetchAllPermissions:h})]}),(0,a.jsx)(w,{fetchAllRoles:u,trans:t,roles:r,fetchAllPermissions:h})]})}}},function(e){e.O(0,[6984,1969,8286,8529,8009,3107,9055,3639,2971,8069,1744],function(){return e(e.s=6940)}),_N_E=e.O()}]);